<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cart - Pooja Kit</title>
</head>
<body>
<h1>Your Cart</h1>
<div id="cart"></div>
<button onclick="checkout()">Checkout</button>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
const cartContainer = document.getElementById('cart');
let cart = JSON.parse(localStorage.getItem('cart') || '[]');

function renderCart() {
  cartContainer.innerHTML = '';
  cart.forEach((item, i) => {
    cartContainer.innerHTML += `<p>${item.name} x ${item.qty} - â‚¹${item.price}</p>`;
  });
}
renderCart();

function checkout() {
  const totalPrice = cart.reduce((sum, i) => sum + i.price * i.qty, 0);
  const orderData = {
    customerName: prompt("Enter your name"),
    customerPhone: prompt("Enter your phone"),
    customerAddress: prompt("Enter your address"),
    products: cart,
    totalPrice
  };

  fetch('https://pooja-kit-hqwc.onrender.com/api/orders', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(orderData)
  })
  .then(res => res.json())
  .then(data => {
    const options = {
      key: 'YOUR_RAZORPAY_KEY_ID',
      amount: data.razorpayOrder.amount,
      currency: 'INR',
      name: 'Pooja Kit Store',
      order_id: data.razorpayOrder.id,
      handler: function(response){
        alert("Payment Successful! Payment ID: " + response.razorpay_payment_id);
        localStorage.removeItem('cart');
        window.location.href = 'index.html';
      }
    };
    const rzp = new Razorpay(options);
    rzp.open();
  });
}
</script>
</body>
</html>
